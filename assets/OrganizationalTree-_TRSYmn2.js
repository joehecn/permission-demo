import{t as B,o as A,a as O}from"./utils-fru_JMu1.js";import{d as ae,f as ne,g as p,h as se,c as D,a as s,b as l,w as c,u as m,F as re,n as M,r as f,o as v,t as N,i as z,j as w,e as x}from"./index-PDdM4U3h.js";const oe=l("div",{class:"global-notes"},[l("p",null,"说明:"),l("ul",null,[l("li",null,"-- 公司管理员 --")])],-1),de=l("h1",null,"部门管理",-1),ce={id:"organizational-tree-page"},ie={id:"org-tree"},ue={class:"el-tree-node__label"},he={class:"drawer-body"},_e={class:"drawer-content"},pe={id:"area-tree"},fe={class:"el-tree-node__label"},be={class:"drawer-footer"},ge={class:"drawer-body"},me={class:"drawer-content"},ke={class:"custom-tree-node-container"},ve={class:"drawer-footer"},Ce=l("h1",null,"创建部门管理员账号",-1),ye={id:"org-tree-wrap"},Ne={class:"el-tree-node__label"},we={key:0,style:{display:"inline-block","margin-left":"8px"}},Pe=ae({__name:"OrganizationalTree",setup(xe){const i=ne(new Map),$=e=>i.get(e)||[],T=(e,t)=>{i.set(e,t),localStorage.setItem(e,JSON.stringify(t))},o=p(),E={label:"label",children:"children",class:e=>e.children?"node":"area"};let C=null;const J=e=>o.value?o.value.getCheckedNodes(!0).map(n=>n.id).includes(e):!1,F=e=>{!e||!o.value.getCheckedNodes(!0).map(n=>n.id).includes(e.id)||(b.value=!0,C=e,M(()=>{var r;const n=$(`org/${(r=h.value)==null?void 0:r.id}/area/${e.id}`);_.value.setCheckedKeys(n)}))},U=()=>{o.value.setCurrentKey(null)},j=()=>{_.value.setCurrentKey(null)},H=e=>{y.value.setCurrentKey(null),e()},y=p(),K={label:"label",children:"children",class:"area"};let h=p(null);const q=e=>{e&&(k.value=!0,h.value=e,M(()=>{const t=$(`org/${e.id}`);o.value.setCheckedKeys(t)}))},k=p(!1),P=()=>{var a;const t=o.value.getCheckedNodes(!0).map(n=>n.id);T(`org/${(a=h.value)==null?void 0:a.id}`,t)},G=()=>{P(),y.value.setCurrentKey(null),k.value=!1},_=p(),b=p(!1),L=[{id:4095,label:"区域资源",children:[{id:63,label:"设备",children:[{id:7,label:"门禁",isPenultimate:!0,children:[{id:1,label:"只读"},{id:2,label:"可写",disabled:!0},{id:4,label:"控制"}]},{id:56,label:"灯",isPenultimate:!0,children:[{id:8,label:"只读"},{id:16,label:"可写",disabled:!0},{id:32,label:"控制"}]}]},{id:192,label:"文档",isPenultimate:!0,children:[{id:64,label:"只读"},{id:128,label:"可写"}]},{id:3840,label:"仪表盘",disabled:!0,children:[{id:768,label:"中控面板",disabled:!0,isPenultimate:!0,children:[{id:256,label:"只读",disabled:!0},{id:512,label:"可写",disabled:!0}]},{id:3072,label:"数据图表",isPenultimate:!0,children:[{id:1024,label:"只读"},{id:2048,label:"可写"}]}]}]}],Q=()=>{var a;const t=_.value.getCheckedNodes(!0).map(n=>n.id);T(`org/${(a=h.value)==null?void 0:a.id}/area/${C.id}`,t),_.value.setCurrentKey(null),o.value.setCurrentKey(null),b.value=!1,P()},W=e=>{_.value.setCurrentKey(null),o.value.setCurrentKey(null),e()},X=e=>!!i.get(e),Y=e=>{const t=i.get(e);if(!t)return!1;for(const a of t){const n=`${e}/area/${a}`;if(!i.get(n))return!1}return!0},Z=()=>{const e=B(A),t=B(O);e.forEach(a=>{const n=localStorage.getItem(`org/${a}`);n&&(i.set(`org/${a}`,JSON.parse(n)),t.forEach(r=>{const g=localStorage.getItem(`org/${a}/area/${r}`);g&&i.set(`org/${a}/area/${r}`,JSON.parse(g))}))})},ee=e=>e.isPenultimate?"is-penultimate":null,le=[{id:1,label:"公司",isPenultimate:!0,children:[{id:2,label:"产品部",isPenultimate:!0,children:[{id:3,label:"p-admin@club.com"}]},{id:4,label:"开发部",isPenultimate:!0,children:[{id:5,label:"d-admin@club.com"},{id:6,label:"前端组",isPenultimate:!0,children:[{id:7,label:"df-admin@club.com"}]},{id:6,label:"后端组",isPenultimate:!0,children:[{id:7,label:"db-admin@club.com"}]}]}]}];return se(()=>{Z()}),(e,t)=>{var R;const a=f("el-divider"),n=f("el-badge"),r=f("el-tree"),g=f("el-button"),S=f("el-drawer"),te=f("el-tag");return v(),D(re,null,[oe,s(a),de,l("div",ce,[l("div",ie,[s(r,{ref_key:"orgTreeRef",ref:y,"check-on-click-node":"","default-expand-all":"","node-key":"id",data:m(A),props:K,"expand-on-click-node":!1,onCurrentChange:q},{default:c(({node:d,data:u})=>[l("span",ue,[l("span",null,N(d.label),1),s(n,{style:{"margin-right":"3px"},"is-dot":"",type:Y(`org/${u.id}`)?"success":"warning"},null,8,["type"])])]),_:1},8,["data"])]),s(S,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=d=>k.value=d),size:600,title:((R=m(h))==null?void 0:R.label)+" - 选择区域","show-close":!1,"before-close":H},{default:c(()=>{var d;return[l("div",he,[l("div",_e,[l("div",pe,[s(r,{ref_key:"areaTreeRef",ref:o,"default-expand-all":"","node-key":"id","show-checkbox":"",data:m(O),props:E,"expand-on-click-node":!1,onCurrentChange:F,onCheckChange:U},{default:c(({node:u,data:V})=>{var I;return[l("span",fe,[l("span",null,N(u.label),1),J(V.id)?(v(),z(n,{key:0,style:{"margin-right":"3px"},"is-dot":"",type:X(`org/${(I=m(h))==null?void 0:I.id}/area/${V.id}`)?"success":"warning"},null,8,["type"])):w("",!0)])]}),_:1},8,["data"])])]),l("div",be,[s(g,{type:"primary",onClick:G},{default:c(()=>[x("Save")]),_:1})]),s(S,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=u=>b.value=u),title:((d=m(C))==null?void 0:d.label)+" - 选择区域资源","append-to-body":!0,"show-close":!1,"before-close":W},{default:c(()=>[l("div",ge,[l("div",me,[l("div",ke,[b.value?(v(),z(r,{key:0,ref_key:"areaResourceRef",ref:_,"node-key":"id","show-checkbox":"","default-expand-all":"",data:L,"expand-on-click-node":!1,props:K,onCheckChange:j},null,512)):w("",!0)])]),l("div",ve,[s(g,{type:"primary",onClick:Q},{default:c(()=>[x("Save")]),_:1})])])]),_:1},8,["modelValue","title"])])]}),_:1},8,["modelValue","title"])]),s(a),Ce,l("div",ye,[s(r,{"default-expand-all":"","node-key":"id",data:le,props:{class:ee},"expand-on-click-node":!1},{default:c(({node:d,data:u})=>[l("span",Ne,[l("span",null,N(d.label),1),u.isPenultimate?w("",!0):(v(),D("span",we,[s(te,{type:"info"},{default:c(()=>[x("部门管理员 (功能角色)")]),_:1})]))])]),_:1},8,["props"])])],64)}}});export{Pe as default};
