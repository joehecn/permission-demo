import{t as $,a as x,f as ie,b as U,c as j,o as ue}from"./utils-fru_JMu1.js";import{d as he,f as fe,g as c,h as pe,c as K,a as i,b as s,w as h,u as R,F as _e,n as z,r as m,o as v,t as I,e as D,i as H,j as q}from"./index-Lpq5kVFc.js";const be=s("div",{class:"global-notes"},[s("p",null,"说明:"),s("ul",null,[s("li",null,"-- 部门管理员 --")])],-1),me=s("h1",null,"数据角色",-1),ge={id:"org-tree-wrap"},ke={class:"el-tree-node__label"},ve={key:0},Ce={key:1},ye={class:"drawer-body"},$e={class:"drawer-content"},Ne={id:"area-tree"},we={class:"el-tree-node__label"},Se={class:"drawer-footer"},Pe={class:"drawer-body"},Te={class:"drawer-content"},xe={class:"custom-tree-node-container"},Ke={class:"drawer-footer"},Ve=he({__name:"DataRole",setup(Re){const o=fe(new Map),N=$(x),V=c(x),C=e=>o.get(e)||[],A=(e,t)=>{o.set(e,t),localStorage.setItem(e,JSON.stringify(t))},G=e=>!!o.get(e),L=e=>{const t=o.get(e);if(!t)return!1;for(const a of t){const l=`${e}/area/${a}`;if(!o.get(l))return!1}return!0},Q=e=>e.isPenultimate?"is-penultimate":null,W=e=>e.children?"node":"area",w=c(),S=[{id:1,label:"公司",isPenultimate:!0,children:[{id:3,label:"产品部",isPenultimate:!0,children:[{id:7,label:"数据角色1"}]},{id:4,label:"开发部",isPenultimate:!0,children:[{id:8,label:"数据角色2"},{id:5,label:"前端组",isPenultimate:!0,children:[{id:9,label:"数据角色3"}]},{id:6,label:"后端组",isPenultimate:!0,children:[{id:10,label:"数据角色4"}]}]}]}];let f=c(null),B=c(null);const X=e=>{if(!e||e.children)return;const t=ie(S,e.id);B.value=t;const a=C(`org/${t.id}`),l=U(a,N);V.value=j(x,l),y.value=!0,f.value=e,z(()=>{const n=C(`data/${e.id}`);d.value.setCheckedKeys(n)})},y=c(!1),O=()=>{var a;const t=d.value.getCheckedNodes(!0).map(l=>l.id);A(`data/${(a=f.value)==null?void 0:a.id}`,t)},Y=()=>{O(),w.value.setCurrentKey(null),y.value=!1},Z={label:"label",children:"children",class:"area"},ee={label:"label",children:"children",class:W},d=c(),ae=e=>{w.value.setCurrentKey(null),e()};let P=null;const te=e=>d.value?d.value.getCheckedNodes(!0).map(l=>l.id).includes(e):!1,le=e=>{var r;if(!e||!d.value.getCheckedNodes(!0).map(_=>_.id).includes(e.id))return;const l=C(`org/${(r=B.value)==null?void 0:r.id}/area/${e.id}`),n=U(l,ne);E.value=j(T,n),g.value=!0,P=e,z(()=>{var k;const _=C(`data/${(k=f.value)==null?void 0:k.id}/area/${e.id}`);p.value.setCheckedKeys(_)})},se=()=>{d.value.setCurrentKey(null)},re=()=>{p.value.setCurrentKey(null)},p=c(),g=c(!1),T=[{id:4095,label:"区域资源",children:[{id:63,label:"设备",children:[{id:7,label:"门禁",isPenultimate:!0,children:[{id:1,label:"只读"},{id:2,label:"可写",disabled:!0},{id:4,label:"控制"}]},{id:56,label:"灯",isPenultimate:!0,children:[{id:8,label:"只读"},{id:16,label:"可写",disabled:!0},{id:32,label:"控制"}]}]},{id:192,label:"文档",isPenultimate:!0,children:[{id:64,label:"只读"},{id:128,label:"可写"}]},{id:3840,label:"仪表盘",disabled:!0,children:[{id:768,label:"中控面板",disabled:!0,isPenultimate:!0,children:[{id:256,label:"只读",disabled:!0},{id:512,label:"可写",disabled:!0}]},{id:3072,label:"数据图表",isPenultimate:!0,children:[{id:1024,label:"只读"},{id:2048,label:"可写"}]}]}]}],ne=$(T),E=c(T),oe=()=>{var a;const t=p.value.getCheckedNodes(!0).map(l=>l.id);A(`data/${(a=f.value)==null?void 0:a.id}/area/${P.id}`,t),p.value.setCurrentKey(null),d.value.setCurrentKey(null),g.value=!1,O()},de=e=>{p.value.setCurrentKey(null),d.value.setCurrentKey(null),e()},ce=()=>{$(ue).forEach(a=>{const l=localStorage.getItem(`org/${a}`);l&&(o.set(`org/${a}`,JSON.parse(l)),N.forEach(n=>{const r=localStorage.getItem(`org/${a}/area/${n}`);r&&o.set(`org/${a}/area/${n}`,JSON.parse(r))}))}),$(S).forEach(a=>{const l=localStorage.getItem(`data/${a}`);l&&(o.set(`data/${a}`,JSON.parse(l)),N.forEach(n=>{const r=localStorage.getItem(`data/${a}/area/${n}`);r&&o.set(`data/${a}/area/${n}`,JSON.parse(r))}))})};return pe(()=>{ce()}),(e,t)=>{var J;const a=m("el-divider"),l=m("el-badge"),n=m("el-tag"),r=m("el-tree"),_=m("el-button"),k=m("el-drawer");return v(),K(_e,null,[be,i(a),me,s("div",ge,[i(r,{ref_key:"dataTreeRef",ref:w,"check-on-click-node":"","default-expand-all":"","node-key":"id",data:S,props:{class:Q},"expand-on-click-node":!1,onCurrentChange:X},{default:h(({node:u,data:b})=>[s("span",ke,[b.isPenultimate?(v(),K("span",ve,I(u.label),1)):(v(),K("span",Ce,[i(n,null,{default:h(()=>[D(I(u.label)+" ",1),i(l,{style:{"margin-right":"3px"},"is-dot":"",type:L(`data/${b.id}`)?"success":"warning"},null,8,["type"])]),_:2},1024)]))])]),_:1},8,["props"]),i(k,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=u=>y.value=u),size:600,title:((J=R(f))==null?void 0:J.label)+" - 选择区域","show-close":!1,"before-close":ae},{default:h(()=>{var u;return[s("div",ye,[s("div",$e,[s("div",Ne,[i(r,{ref_key:"areaTreeRef",ref:d,"default-expand-all":"","node-key":"id","show-checkbox":"",data:V.value,props:ee,"expand-on-click-node":!1,onCurrentChange:le,onCheckChange:se},{default:h(({node:b,data:M})=>{var F;return[s("span",we,[s("span",null,I(b.label),1),te(M.id)?(v(),H(l,{key:0,style:{"margin-right":"3px"},"is-dot":"",type:G(`data/${(F=R(f))==null?void 0:F.id}/area/${M.id}`)?"success":"warning"},null,8,["type"])):q("",!0)])]}),_:1},8,["data"])])]),s("div",Se,[i(_,{type:"primary",onClick:Y},{default:h(()=>[D("Save")]),_:1})]),i(k,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=b=>g.value=b),title:((u=R(P))==null?void 0:u.label)+" - 选择区域资源","append-to-body":!0,"show-close":!1,"before-close":de},{default:h(()=>[s("div",Pe,[s("div",Te,[s("div",xe,[g.value?(v(),H(r,{key:0,ref_key:"areaResourceRef",ref:p,"node-key":"id","show-checkbox":"","default-expand-all":"",data:E.value,"expand-on-click-node":!1,props:Z,onCheckChange:re},null,8,["data"])):q("",!0)])]),s("div",Ke,[i(_,{type:"primary",onClick:oe},{default:h(()=>[D("Save")]),_:1})])])]),_:1},8,["modelValue","title"])])]}),_:1},8,["modelValue","title"])])],64)}}});export{Ve as default};
